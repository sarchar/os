#ifndef __INTERRUPTS_H__
#define __INTERRUPTS_H__

#define NUM_INTERRUPTS 256

struct interrupt_stack_registers {
    // the order of this structure must match the order of the registers
    // pushed onto the stack in _interrupt_handler_common
    u64 r15;
    u64 r14;
    u64 r13;
    u64 r12;
    u64 r11;
    u64 r10;
    u64 r9;
    u64 r8;
    u64 rbx;
    u64 rsi;
    u64 rdi;
    u64 rdx;
    u64 rcx;
    u64 rax;
    u64 rbp;
    // the following 5 are pushed by the CPU, but rsp/ss are only valid if the DPL in the cs
    // is not equal to the current PL.
    u64 rip;
    u64 cs;
    u64 rflags;
    u64 rsp;
    u64 ss;
};

void interrupts_init();

typedef void (installable_irq_handler)(struct interrupt_stack_registers*, intp, void*);
void interrupts_install_handler(u8, installable_irq_handler*, void*);

// the interrupt handlers, externed for idt.c
typedef void (*interrupt_handler)();
void interrupt_stub();
void interrupt_stub_noerr();

void interrupt_div_by_zero();
void interrupt_invalid_op();
void interrupt_gpf();
void interrupt_page_fault();

// our system call will be at 0x81. In the future, 0x80 will be for linux system call support
void interrupt_syscall();

#define DECLARE_INSTALLABLE_INTERRUPT(n) void interrupt_installable_##n()

DECLARE_INSTALLABLE_INTERRUPT(32);
DECLARE_INSTALLABLE_INTERRUPT(33);
DECLARE_INSTALLABLE_INTERRUPT(34);
DECLARE_INSTALLABLE_INTERRUPT(35);
DECLARE_INSTALLABLE_INTERRUPT(36);
DECLARE_INSTALLABLE_INTERRUPT(37);
DECLARE_INSTALLABLE_INTERRUPT(38);
DECLARE_INSTALLABLE_INTERRUPT(39);
DECLARE_INSTALLABLE_INTERRUPT(40);
DECLARE_INSTALLABLE_INTERRUPT(41);
DECLARE_INSTALLABLE_INTERRUPT(42);
DECLARE_INSTALLABLE_INTERRUPT(43);
DECLARE_INSTALLABLE_INTERRUPT(44);
DECLARE_INSTALLABLE_INTERRUPT(45);
DECLARE_INSTALLABLE_INTERRUPT(46);
DECLARE_INSTALLABLE_INTERRUPT(47);
DECLARE_INSTALLABLE_INTERRUPT(48);
DECLARE_INSTALLABLE_INTERRUPT(49);
DECLARE_INSTALLABLE_INTERRUPT(50);
DECLARE_INSTALLABLE_INTERRUPT(51);
DECLARE_INSTALLABLE_INTERRUPT(52);
DECLARE_INSTALLABLE_INTERRUPT(53);
DECLARE_INSTALLABLE_INTERRUPT(54);
DECLARE_INSTALLABLE_INTERRUPT(55);
DECLARE_INSTALLABLE_INTERRUPT(56);
DECLARE_INSTALLABLE_INTERRUPT(57);
DECLARE_INSTALLABLE_INTERRUPT(58);
DECLARE_INSTALLABLE_INTERRUPT(59);
DECLARE_INSTALLABLE_INTERRUPT(60);
DECLARE_INSTALLABLE_INTERRUPT(61);
DECLARE_INSTALLABLE_INTERRUPT(62);
DECLARE_INSTALLABLE_INTERRUPT(63);
DECLARE_INSTALLABLE_INTERRUPT(64);
DECLARE_INSTALLABLE_INTERRUPT(65);
DECLARE_INSTALLABLE_INTERRUPT(66);
DECLARE_INSTALLABLE_INTERRUPT(67);
DECLARE_INSTALLABLE_INTERRUPT(68);
DECLARE_INSTALLABLE_INTERRUPT(69);
DECLARE_INSTALLABLE_INTERRUPT(70);
DECLARE_INSTALLABLE_INTERRUPT(71);
DECLARE_INSTALLABLE_INTERRUPT(72);
DECLARE_INSTALLABLE_INTERRUPT(73);
DECLARE_INSTALLABLE_INTERRUPT(74);
DECLARE_INSTALLABLE_INTERRUPT(75);
DECLARE_INSTALLABLE_INTERRUPT(76);
DECLARE_INSTALLABLE_INTERRUPT(77);
DECLARE_INSTALLABLE_INTERRUPT(78);
DECLARE_INSTALLABLE_INTERRUPT(79);
DECLARE_INSTALLABLE_INTERRUPT(80);
DECLARE_INSTALLABLE_INTERRUPT(81);
DECLARE_INSTALLABLE_INTERRUPT(82);
DECLARE_INSTALLABLE_INTERRUPT(83);
DECLARE_INSTALLABLE_INTERRUPT(84);
DECLARE_INSTALLABLE_INTERRUPT(85);
DECLARE_INSTALLABLE_INTERRUPT(86);
DECLARE_INSTALLABLE_INTERRUPT(87);
DECLARE_INSTALLABLE_INTERRUPT(88);
DECLARE_INSTALLABLE_INTERRUPT(89);
DECLARE_INSTALLABLE_INTERRUPT(90);
DECLARE_INSTALLABLE_INTERRUPT(91);
DECLARE_INSTALLABLE_INTERRUPT(92);
DECLARE_INSTALLABLE_INTERRUPT(93);
DECLARE_INSTALLABLE_INTERRUPT(94);
DECLARE_INSTALLABLE_INTERRUPT(95);
DECLARE_INSTALLABLE_INTERRUPT(96);
DECLARE_INSTALLABLE_INTERRUPT(97);
DECLARE_INSTALLABLE_INTERRUPT(98);
DECLARE_INSTALLABLE_INTERRUPT(99);
DECLARE_INSTALLABLE_INTERRUPT(100);
DECLARE_INSTALLABLE_INTERRUPT(101);
DECLARE_INSTALLABLE_INTERRUPT(102);
DECLARE_INSTALLABLE_INTERRUPT(103);
DECLARE_INSTALLABLE_INTERRUPT(104);
DECLARE_INSTALLABLE_INTERRUPT(105);
DECLARE_INSTALLABLE_INTERRUPT(106);
DECLARE_INSTALLABLE_INTERRUPT(107);
DECLARE_INSTALLABLE_INTERRUPT(108);
DECLARE_INSTALLABLE_INTERRUPT(109);
DECLARE_INSTALLABLE_INTERRUPT(110);
DECLARE_INSTALLABLE_INTERRUPT(111);
DECLARE_INSTALLABLE_INTERRUPT(112);
DECLARE_INSTALLABLE_INTERRUPT(113);
DECLARE_INSTALLABLE_INTERRUPT(114);
DECLARE_INSTALLABLE_INTERRUPT(115);
DECLARE_INSTALLABLE_INTERRUPT(116);
DECLARE_INSTALLABLE_INTERRUPT(117);
DECLARE_INSTALLABLE_INTERRUPT(118);
DECLARE_INSTALLABLE_INTERRUPT(119);
DECLARE_INSTALLABLE_INTERRUPT(120);
DECLARE_INSTALLABLE_INTERRUPT(121);
DECLARE_INSTALLABLE_INTERRUPT(122);
DECLARE_INSTALLABLE_INTERRUPT(123);
DECLARE_INSTALLABLE_INTERRUPT(124);
DECLARE_INSTALLABLE_INTERRUPT(125);
DECLARE_INSTALLABLE_INTERRUPT(126);
DECLARE_INSTALLABLE_INTERRUPT(127);
DECLARE_INSTALLABLE_INTERRUPT(128);
DECLARE_INSTALLABLE_INTERRUPT(130);
DECLARE_INSTALLABLE_INTERRUPT(131);
DECLARE_INSTALLABLE_INTERRUPT(132);
DECLARE_INSTALLABLE_INTERRUPT(133);
DECLARE_INSTALLABLE_INTERRUPT(134);
DECLARE_INSTALLABLE_INTERRUPT(135);
DECLARE_INSTALLABLE_INTERRUPT(136);
DECLARE_INSTALLABLE_INTERRUPT(137);
DECLARE_INSTALLABLE_INTERRUPT(138);
DECLARE_INSTALLABLE_INTERRUPT(139);
DECLARE_INSTALLABLE_INTERRUPT(140);
DECLARE_INSTALLABLE_INTERRUPT(141);
DECLARE_INSTALLABLE_INTERRUPT(142);
DECLARE_INSTALLABLE_INTERRUPT(143);
DECLARE_INSTALLABLE_INTERRUPT(144);
DECLARE_INSTALLABLE_INTERRUPT(145);
DECLARE_INSTALLABLE_INTERRUPT(146);
DECLARE_INSTALLABLE_INTERRUPT(147);
DECLARE_INSTALLABLE_INTERRUPT(148);
DECLARE_INSTALLABLE_INTERRUPT(149);
DECLARE_INSTALLABLE_INTERRUPT(150);
DECLARE_INSTALLABLE_INTERRUPT(151);
DECLARE_INSTALLABLE_INTERRUPT(152);
DECLARE_INSTALLABLE_INTERRUPT(153);
DECLARE_INSTALLABLE_INTERRUPT(154);
DECLARE_INSTALLABLE_INTERRUPT(155);
DECLARE_INSTALLABLE_INTERRUPT(156);
DECLARE_INSTALLABLE_INTERRUPT(157);
DECLARE_INSTALLABLE_INTERRUPT(158);
DECLARE_INSTALLABLE_INTERRUPT(159);
DECLARE_INSTALLABLE_INTERRUPT(160);
DECLARE_INSTALLABLE_INTERRUPT(161);
DECLARE_INSTALLABLE_INTERRUPT(162);
DECLARE_INSTALLABLE_INTERRUPT(163);
DECLARE_INSTALLABLE_INTERRUPT(164);
DECLARE_INSTALLABLE_INTERRUPT(165);
DECLARE_INSTALLABLE_INTERRUPT(166);
DECLARE_INSTALLABLE_INTERRUPT(167);
DECLARE_INSTALLABLE_INTERRUPT(168);
DECLARE_INSTALLABLE_INTERRUPT(169);
DECLARE_INSTALLABLE_INTERRUPT(170);
DECLARE_INSTALLABLE_INTERRUPT(171);
DECLARE_INSTALLABLE_INTERRUPT(172);
DECLARE_INSTALLABLE_INTERRUPT(173);
DECLARE_INSTALLABLE_INTERRUPT(174);
DECLARE_INSTALLABLE_INTERRUPT(175);
DECLARE_INSTALLABLE_INTERRUPT(176);
DECLARE_INSTALLABLE_INTERRUPT(177);
DECLARE_INSTALLABLE_INTERRUPT(178);
DECLARE_INSTALLABLE_INTERRUPT(179);
DECLARE_INSTALLABLE_INTERRUPT(180);
DECLARE_INSTALLABLE_INTERRUPT(181);
DECLARE_INSTALLABLE_INTERRUPT(182);
DECLARE_INSTALLABLE_INTERRUPT(183);
DECLARE_INSTALLABLE_INTERRUPT(184);
DECLARE_INSTALLABLE_INTERRUPT(185);
DECLARE_INSTALLABLE_INTERRUPT(186);
DECLARE_INSTALLABLE_INTERRUPT(187);
DECLARE_INSTALLABLE_INTERRUPT(188);
DECLARE_INSTALLABLE_INTERRUPT(189);
DECLARE_INSTALLABLE_INTERRUPT(190);
DECLARE_INSTALLABLE_INTERRUPT(191);
DECLARE_INSTALLABLE_INTERRUPT(192);
DECLARE_INSTALLABLE_INTERRUPT(193);
DECLARE_INSTALLABLE_INTERRUPT(194);
DECLARE_INSTALLABLE_INTERRUPT(195);
DECLARE_INSTALLABLE_INTERRUPT(196);
DECLARE_INSTALLABLE_INTERRUPT(197);
DECLARE_INSTALLABLE_INTERRUPT(198);
DECLARE_INSTALLABLE_INTERRUPT(199);
DECLARE_INSTALLABLE_INTERRUPT(200);
DECLARE_INSTALLABLE_INTERRUPT(201);
DECLARE_INSTALLABLE_INTERRUPT(202);
DECLARE_INSTALLABLE_INTERRUPT(203);
DECLARE_INSTALLABLE_INTERRUPT(204);
DECLARE_INSTALLABLE_INTERRUPT(205);
DECLARE_INSTALLABLE_INTERRUPT(206);
DECLARE_INSTALLABLE_INTERRUPT(207);
DECLARE_INSTALLABLE_INTERRUPT(208);
DECLARE_INSTALLABLE_INTERRUPT(209);
DECLARE_INSTALLABLE_INTERRUPT(210);
DECLARE_INSTALLABLE_INTERRUPT(211);
DECLARE_INSTALLABLE_INTERRUPT(212);
DECLARE_INSTALLABLE_INTERRUPT(213);
DECLARE_INSTALLABLE_INTERRUPT(214);
DECLARE_INSTALLABLE_INTERRUPT(215);
DECLARE_INSTALLABLE_INTERRUPT(216);
DECLARE_INSTALLABLE_INTERRUPT(217);
DECLARE_INSTALLABLE_INTERRUPT(218);
DECLARE_INSTALLABLE_INTERRUPT(219);
DECLARE_INSTALLABLE_INTERRUPT(220);
DECLARE_INSTALLABLE_INTERRUPT(221);
DECLARE_INSTALLABLE_INTERRUPT(222);
DECLARE_INSTALLABLE_INTERRUPT(223);
DECLARE_INSTALLABLE_INTERRUPT(224);
DECLARE_INSTALLABLE_INTERRUPT(225);
DECLARE_INSTALLABLE_INTERRUPT(226);
DECLARE_INSTALLABLE_INTERRUPT(227);
DECLARE_INSTALLABLE_INTERRUPT(228);
DECLARE_INSTALLABLE_INTERRUPT(229);
DECLARE_INSTALLABLE_INTERRUPT(230);
DECLARE_INSTALLABLE_INTERRUPT(231);
DECLARE_INSTALLABLE_INTERRUPT(232);
DECLARE_INSTALLABLE_INTERRUPT(233);
DECLARE_INSTALLABLE_INTERRUPT(234);
DECLARE_INSTALLABLE_INTERRUPT(235);
DECLARE_INSTALLABLE_INTERRUPT(236);
DECLARE_INSTALLABLE_INTERRUPT(237);
DECLARE_INSTALLABLE_INTERRUPT(238);
DECLARE_INSTALLABLE_INTERRUPT(239);
DECLARE_INSTALLABLE_INTERRUPT(240);
DECLARE_INSTALLABLE_INTERRUPT(241);
DECLARE_INSTALLABLE_INTERRUPT(242);
DECLARE_INSTALLABLE_INTERRUPT(243);
DECLARE_INSTALLABLE_INTERRUPT(244);
DECLARE_INSTALLABLE_INTERRUPT(245);
DECLARE_INSTALLABLE_INTERRUPT(246);
DECLARE_INSTALLABLE_INTERRUPT(247);
DECLARE_INSTALLABLE_INTERRUPT(248);
DECLARE_INSTALLABLE_INTERRUPT(249);
DECLARE_INSTALLABLE_INTERRUPT(250);
DECLARE_INSTALLABLE_INTERRUPT(251);
DECLARE_INSTALLABLE_INTERRUPT(252);
DECLARE_INSTALLABLE_INTERRUPT(253);
DECLARE_INSTALLABLE_INTERRUPT(254);
DECLARE_INSTALLABLE_INTERRUPT(255);

#undef DECLARE_INSTALLABLE_INTERRUPT

#endif
